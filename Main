-- Walvy Community Script - Dengan ESP Base Cooldown

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Walvy Community",
    LoadingTitle = "Walvy Community",
    LoadingSubtitle = "by Walvy",
    ConfigurationSaving = {
       Enabled = true,
       FolderName = "Walvy",
       FileName = "Settings"
    },
    Discord = {
       Enabled = true,
       Invite = "EXK4dQxJBv",
       RememberJoins = true
    },
    KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458)

local StatusLabel = MainTab:CreateParagraph({
    Title = "Status",
    Content = "Ready to Teleport."
})

Rayfield:Notify({
    Title = "✅ Walvy Community Loaded",
    Content = "Script berhasil dijalankan!",
    Duration = 6,
    Image = 4483362458
})

-- Service Setup
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

local tpAmt = 80
local void = CFrame.new(0, -3.4028234663852886e+38, 0)
local teleporting = false
local random = Random.new()

-- Teleport Function
local function TP(position)
    if not teleporting then
        teleporting = true
        if typeof(position) == "CFrame" then
            hrp.CFrame = position + Vector3.new(
                random:NextNumber(-0.0001, 0.0001),
                random:NextNumber(-0.0001, 0.0001),
                random:NextNumber(-0.0001, 0.0001)
            )
            RunService.Heartbeat:Wait()
            teleporting = false
        end
    end
end

-- TP Functions
function DeliverBrainrot(label)
    local plots = Workspace:FindFirstChild("Plots")
    if not plots then return end
    for _, plot in pairs(plots:GetChildren()) do
        local sign = plot:FindFirstChild("PlotSign")
        if sign and sign:FindFirstChild("YourBase") and sign.YourBase.Enabled then
            local hitbox = plot:FindFirstChild("DeliveryHitbox")
            if hitbox then
                local target = hitbox.CFrame * CFrame.new(0, -3, 0)
                for i = 1, tpAmt do TP(target) end
                TP(void)
                for i = 1, tpAmt/16 do TP(target) end
                task.wait(1)
                local dist = (hrp.Position - target.Position).Magnitude
                label.Text("TP Succeeded! Distance: "..math.floor(dist))
                return
            end
        end
    end
    label.Text("DeliveryHitbox Not Found")
end

function TPNearestBase(label)
    local plots = Workspace:FindFirstChild("Plots")
    if not plots then return end
    local closest, shortest = nil, math.huge
    for _, plot in pairs(plots:GetChildren()) do
        local sign = plot:FindFirstChild("PlotSign")
        if sign and sign:FindFirstChild("YourBase") and not sign.YourBase.Enabled then
            local podiums = plot:FindFirstChild("AnimalPodiums")
            if podiums then
                for _, p in pairs(podiums:GetChildren()) do
                    local spawn = p:FindFirstChild("Base") and p.Base:FindFirstChild("Spawn")
                    if spawn then
                        local dist = (spawn.Position - hrp.Position).Magnitude
                        if dist < shortest then
                            shortest = dist
                            closest = spawn
                        end
                    end
                end
            end
        end
    end
    if closest then
        local target = closest.CFrame * CFrame.new(0, 2, 0)
        for i = 1, tpAmt do TP(target) end
        TP(void)
        for i = 1, tpAmt/16 do TP(target) end
        task.wait(1)
        local dist = (hrp.Position - target.Position).Magnitude
        label.Text("TP Base Success! Distance: "..math.floor(dist))
    else
        label.Text("No Valid Base Found")
    end
end

function TweenSteal(label)
    local delivery
    for _, v in ipairs(Workspace.Plots:GetDescendants()) do
        if v.Name == "DeliveryHitbox" and v.Parent:FindFirstChild("PlotSign") and v.Parent.PlotSign:FindFirstChild("YourBase") and v.Parent.PlotSign.YourBase.Enabled then
            delivery = v
            break
        end
    end
    if not delivery then label.Text("DeliveryHitbox Not Found") return end
    local target = delivery.CFrame * CFrame.new(0, -3, 0)
    for i = 1, tpAmt do TP(target) end
    TP(void)
    for i = 1, tpAmt/16 do TP(target) end
    task.wait(1)
    local dist = (hrp.Position - target.Position).Magnitude
    label.Text("Tween TP Complete! Distance: "..math.floor(dist))
end

-- ██████ ✨ ESP BASE BUTTON ✨ ██████

local function StartESPBase()
    local Plots = Workspace:FindFirstChild("Plots")
    if not Plots then
        warn("❌ Folder 'Plots' tidak ditemukan.")
        return
    end

    local function findCooldownTextLabel(baseModel)
        for _, obj in ipairs(baseModel:GetDescendants()) do
            if obj:IsA("TextLabel") and obj.Text:match("^%d+s$") then
                return obj
            end
        end
        return nil
    end

    for _, baseModel in ipairs(Plots:GetChildren()) do
        if baseModel:IsA("Model") then
            local mainPart = baseModel.PrimaryPart or baseModel:FindFirstChildWhichIsA("BasePart", true)
            if mainPart and not baseModel:FindFirstChild("BaseESP") then
                local bb = Instance.new("BillboardGui")
                bb.Name = "BaseESP"
                bb.Adornee = mainPart
                bb.Size = UDim2.new(0, 200, 0, 50)
                bb.StudsOffset = Vector3.new(0, 6, 0)
                bb.AlwaysOnTop = true
                bb.Parent = baseModel

                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(1, 0, 1, 0)
                label.BackgroundTransparency = 1
                label.TextScaled = true
                label.Font = Enum.Font.GothamBold
                label.TextStrokeTransparency = 0.2
                label.TextColor3 = Color3.fromRGB(255, 255, 0)
                label.Text = "⛺ BASE"
                label.Parent = bb

                task.spawn(function()
                    while baseModel.Parent do
                        local cooldownLabel = findCooldownTextLabel(baseModel)
                        if cooldownLabel then
                            local secondsLeft = tonumber(cooldownLabel.Text:match("^(%d+)s"))
                            if secondsLeft and secondsLeft <= 2 then
                                label.Text = "✅ Ready"
                                label.TextColor3 = Color3.fromRGB(0, 255, 0)
                            else
                                label.Text = "⏳ " .. cooldownLabel.Text
                                label.TextColor3 = Color3.fromRGB(255, 140, 0)
                            end
                        else
                            label.Text = "✅ Unlocked"
                            label.TextColor3 = Color3.fromRGB(0, 255, 0)
                        end
                        task.wait(1)
                    end
                end)
            end
        end
    end
end

-- Tambahkan tombol untuk ESP Base
MainTab:CreateButton({
    Name = "🔎 ESP Base + Cooldown",
    Callback = function()
        StartESPBase()
        StatusLabel:Set({Content = "ESP Base Activated"})
    end
})

-- Tombol TP
MainTab:CreateButton({
    Name = "TP To Delivery Box",
    Callback = function()
        DeliverBrainrot({Text = function(v) StatusLabel:Set({Content = v}) end})
    end
})

MainTab:CreateButton({
    Name = "TP Inside Nearest Base",
    Callback = function()
        TPNearestBase({Text = function(v) StatusLabel:Set({Content = v}) end})
    end
})

MainTab:CreateButton({
    Name = "Tween Steal",
    Callback = function()
        TweenSteal({Text = function(v) StatusLabel:Set({Content = v}) end})
    end
})

MainTab:CreateParagraph({
    Title = "Hotkey",
    Content = "Press RightShift to hide/show GUI"
})
